pico-8 cartridge // http://www.pico-8.com
version 33
__lua__
function has_value(t,v) -- table,value
 for i,val in ipairs(t) do
  if v==val then
   return true
  end
 end
 return false
end

function _init()
end

// c-style ternary operator
function t(cond,a,b)
	if cond==0 or cond==nil or
	not cond then
		return b
	else
		return a
	end
end

// c-style not.
function neg(a)
	return t(a,0,1)
end

// clamp (value, min, max)
function cla(x,mn,mx)
 return t(x>mx,mx,t(x<mn,mn,x))
end

-- random integer	
function irnd(n)
	return flr(rnd(n))
end

-- is n odd?
function odd(n)
	return ((flr(n)&0x01)==0x01)
end

function rect2(x,y,w,h,c)
	rect(x,y,x+w,y+h,c)
end

function rectfill2(x,y,w,h,c)
	rectfill(x,y,x+w,y+h,c)
end
sw=128 -- screen width
sw_h=sw/2 -- screen width half
sh=sw -- screen height
sh_h=sh/2 -- screen height half
timer=0
period=100
function _update()
 if timer==period-1 then
  timer=0
 else
  timer+=1
 end
end

sep_z=1 	-- distance between grid lines
floor_y=50
field_width=1000
horizon_z=floor_y/8
function _draw()
	cls(0)
	theta=time()/32
	for mirror in all({-1,1}) do
		line(64+(cos(theta)*(-field_width)+sin(theta)*floor_y*mirror)/horizon_z,
				64-(-sin(theta)*(-field_width)+cos(theta)*floor_y*mirror)/horizon_z,
				64+(cos(theta)*field_width+sin(theta)*floor_y*mirror)/horizon_z,
				64-(-sin(theta)*field_width+cos(theta)*floor_y*mirror)/horizon_z,
				6)
		for i=1,6 do
			local line_z=i*sep_z-(time()%sep_z)
			line(64+(cos(theta)*(-field_width)+sin(theta)*floor_y*mirror)/line_z,
				64-(-sin(theta)*(-field_width)+cos(theta)*floor_y*mirror)/line_z,
				64+(cos(theta)*field_width+sin(theta)*floor_y*mirror)/line_z,
				64-(-sin(theta)*field_width+cos(theta)*floor_y*mirror)/line_z,
				5)
		end
	end
end
__gfx__
00000000000000000000100000101000001010001010100010101000101010101010101010101010101010111011101111111011111111111111111111111111
00000000000000000000000000000001000000010000010100010101010101010101010101010101010101010101010101010101010111010111110111111111
00000000000000000010000000100000101010001010100010101010101010101010101010101110111011101111111011111111111111111111111111111111
00000000000000010000000100000001000000010100000101010001010100010101010101010101010101010101010101010101011101011111110111111111
00000000100000001000000010000000100000101000101010001010100010101010101010101010101010101010101010111010101111101111111111111111
00000000000000000000010000010100000101000001010001010101010101010101010101110101011101110111111111111111111111111111111111111111
00000000000000000000000010000000101000001010000010100000101010101010101010101010101010101010101010101010101110101011101011111111
00000000000100010001000100010001000101010001010100010101010101010101010101010101110101011101110111011111111111111111111111111111
00000000100010001000100010001000101010101010101010101010101010100000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000101010101010101010101010000000000000000000000000000000000000000000000000000000000000000
00000000000000000010001010101010101010101010101010101010101010100000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000010001000100010000000000000000000000000000000000000000000000000000000000000000
00000000100010001000100010001000101010101010101010101010101010100000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000101010101010101010101010000000000000000000000000000000000000000000000000000000000000000
00000000000000000010001010101010101010101010101010101010101010100000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000010001000100010000000000000000000000000000000000000000000000000000000000000000
11111111bbbb00000011dddd00556677000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
11111111bbbb00000011dddd00556677000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
11111111bbbb00000011dddd00556677000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
11111111bbbb00000011dddd00556677000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
11111111000000000011dddd00556677000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
11111111000000000011dddd00556677000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
11111111000000000011dddd00556677000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
11111111000000000011dddd00556677000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
